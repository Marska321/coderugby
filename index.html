<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Rugby Academy - Learn Python Through Rugby</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1f2937">
    <meta name="description" content="Learn Python programming through rugby analogies and interactive lessons">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rugby: {
                            green: '#006A4E',
                            gold: '#FFD700',
                            navy: '#1f2937'
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom styles for code editor */
        .code-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            background-color: #1e293b;
            color: #e2e8f0;
            border: none;
            outline: none;
            resize: none;
            width: 100%;
            height: 100%;
            padding: 16px;
            tab-size: 4;
        }
        
        .console-output {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.4;
            background-color: #0f172a;
            color: #94a3b8;
            padding: 12px;
            height: 100%;
            overflow-y: auto;
            border-radius: 6px;
            white-space: pre-wrap;
        }
        
        .lesson-content pre {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            margin: 16px 0;
        }
        
        .hint-content {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 12px;
            margin: 12px 0;
            border-radius: 0 6px 6px 0;
        }
        
        /* Responsive grid layout */
        @media (max-width: 768px) {
            .three-panel-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-rugby-navy text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-rugby-green rounded-full flex items-center justify-center">
                        <span class="text-white font-bold text-lg">üèâ</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Python Rugby Academy</h1>
                        <p class="text-gray-300 text-sm">Learn Python through rugby analogies</p>
                    </div>
                </div>
                <div id="user-actions" class="flex items-center space-x-4">
                     <!-- This will be replaced by user info or a sign-in button -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <div class="three-panel-layout grid grid-cols-1 md:grid-cols-3 gap-6 h-[calc(100vh-160px)]">
            <!-- Left Panel: Lesson Instructions -->
            <div class="bg-white rounded-lg shadow-md p-6 overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                     <h2 class="text-xl font-bold text-rugby-navy">Daily Training</h2>
                     <select id="lessonSelector" class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-xs">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div id="lessonContent" class="lesson-content">
                    <!-- Lesson content will be loaded here -->
                </div>
            </div>

            <!-- Middle Panel: Code Editor -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col">
                <div class="bg-gray-800 text-white px-4 py-2 text-sm font-medium">
                    Code Editor
                </div>
                <textarea id="codeEditor" class="code-editor" placeholder="# Write your Python code here..."></textarea>
            </div>

            <!-- Right Panel: Console and Test Runner -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">Test Runner & Console</h3>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Test Cases:</h4>
                    <div id="testList" class="bg-gray-100 p-3 rounded-md text-sm font-mono space-y-2">
                        <!-- Test cases will be loaded here -->
                    </div>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Console Output:</h4>
                    <div id="consoleOutput" class="console-output flex-1">
                        Python Rugby Academy Console
                    </div>
                </div>
                
                <div class="mt-4 flex space-x-2">
                    <button id="runCodeBtn" class="bg-rugby-green hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors flex-grow">
                        Run Tests
                    </button>
                    <button id="clearConsoleBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">
                        Clear
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // --- Your web app's Firebase configuration ---
        // IMPORTANT: Replace this with your own Firebase config object!
        const firebaseConfig = {
            apiKey:"AIzaSyBB1RmG4tMM7MdlSvxSEm4uVodcjBnupTo",
            authDomain:  "python-rugby-coding.firebaseapp.com",
            projectId: "python-rugby-coding",
            storageBucket: "python-rugby-coding.firebasestorage.app",
            messagingSenderId:  "126358162035",
            appId:  "1:126358162035:web:23139b87ca2cab282ef806"
        };

        // --- Initialize Firebase ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // --- Curriculum Data ---
        const curriculum = {
          "1.1": { "module": "Core Fundamentals", "conceptName": "The print() Function", "rugbyAnalogy": "Referee's starting whistle", "masteryDefinition": "Display 'Hello, Rugby World!' to the console.", "prerequisites": [], "example": "print(\"The match is about to begin!\")", "hint": "Make sure the text you want to display is inside the parentheses and enclosed in quotes.", "tests": [ { "description": "Prints 'Hello, Rugby World!'", "test": "return __output.includes('Hello, Rugby World!')" } ] },
          "1.2": { "module": "Core Fundamentals", "conceptName": "Variables", "rugbyAnalogy": "The scoreboard", "masteryDefinition": "Declare a variable named 'home_score' and assign it the value 10.", "prerequisites": [], "example": "away_score = 5", "hint": "Use the equals sign (=) to assign a value.", "tests": [ { "description": "'home_score' variable exists", "test": "return typeof home_score !== 'undefined'" }, { "description": "'home_score' is 10", "test": "return home_score === 10" } ] },
          "1.3": { "module": "Core Fundamentals", "conceptName": "Data Types: Strings", "rugbyAnalogy": "Player names & team names", "masteryDefinition": "Declare a variable named 'team_name' and assign it the string 'Springboks'.", "prerequisites": ["1.2"], "example": "player_name = \"Siya Kolisi\"", "hint": "Remember to enclose the text in quotes.", "tests": [ { "description": "'team_name' variable exists", "test": "return typeof team_name !== 'undefined'" }, { "description": "'team_name' is 'Springboks'", "test": "return team_name === 'Springboks'" } ] },
          "4.1": { "module": "Functions & Modules", "conceptName": "Defining Functions", "rugbyAnalogy": "Designing a set play like a lineout", "masteryDefinition": "Define a function named 'blow_whistle' that prints 'Match Start!'.", "prerequisites": ["3.2"], "example": "def perform_scrum():\n  print(\"Crouch, bind, set!\")", "hint": "Start with the `def` keyword, followed by the function name and parentheses `()`. The code inside must be indented.", "tests": [ { "description": "Function 'blow_whistle' exists", "test": "return typeof blow_whistle === 'function'" }, { "description": "Calling blow_whistle() prints 'Match Start!'", "test": "let temp_output = ''; const old_log = console.log; console.log = (val) => temp_output += val; blow_whistle(); console.log = old_log; return temp_output.includes('Match Start!');" } ] }
        };

        // --- DOM Elements ---
        const lessonContentEl = document.getElementById('lessonContent');
        const codeEditorEl = document.getElementById('codeEditor');
        const consoleOutputEl = document.getElementById('consoleOutput');
        const testListEl = document.getElementById('testList');
        const lessonSelectorEl = document.getElementById('lessonSelector');
        const runCodeBtn = document.getElementById('runCodeBtn');
        const clearConsoleBtn = document.getElementById('clearConsoleBtn');
        const userActionsEl = document.getElementById('user-actions');

        let currentLessonId = null;
        let currentUser = null;

        // --- Authentication ---
        onAuthStateChanged(auth, user => {
            if (user) {
                currentUser = user;
                updateUIForUser(user);
            } else {
                currentUser = null;
                updateUIForGuest();
            }
        });

        function signIn() {
            signInWithPopup(auth, provider).catch(error => {
                console.error("Auth Error:", error);
                appendToConsole(`Authentication Error: ${error.message}`);
            });
        }

        function logOut() {
            signOut(auth);
        }

        // --- UI Updates ---
        function updateUIForUser(user) {
            userActionsEl.innerHTML = `
                <div class="flex items-center space-x-4">
                    <img src="${user.photoURL}" alt="User avatar" class="w-8 h-8 rounded-full">
                    <span class="text-sm font-medium text-gray-300">${user.displayName}</span>
                    <button id="signOutBtn" class="bg-rugby-gold hover:bg-yellow-500 text-gray-800 px-3 py-1 rounded text-sm font-bold transition-colors">Sign Out</button>
                </div>
            `;
            document.getElementById('signOutBtn').addEventListener('click', logOut);
        }

        function updateUIForGuest() {
            userActionsEl.innerHTML = `
                <button id="signInBtn" class="bg-rugby-green hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                    Sign In with Google
                </button>
            `;
            document.getElementById('signInBtn').addEventListener('click', signIn);
        }

        // --- Core App Logic ---
        function populateLessonSelector() {
            for (const key in curriculum) {
                const lesson = curriculum[key];
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `Lesson ${key} - ${lesson.conceptName}`;
                lessonSelectorEl.appendChild(option);
            }
        }

        function loadLesson(lessonId) {
            currentLessonId = lessonId;
            const lesson = curriculum[lessonId];
            if (!lesson) {
                console.error(`Lesson ${lessonId} not found`);
                return;
            }

            lessonContentEl.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-3">${lesson.conceptName}</h3>
                <div class="mb-4">
                    <h4 class="text-md font-medium text-gray-700 mb-2">üèâ Rugby Analogy</h4>
                    <p class="text-gray-600 leading-relaxed">${lesson.rugbyAnalogy}</p>
                </div>
                <div class="mb-4">
                    <h4 class="text-md font-medium text-gray-700 mb-2">üéØ Challenge</h4>
                    <p class="text-gray-800 font-medium">${lesson.masteryDefinition}</p>
                </div>
                <div class="mb-4">
                    <h4 class="text-md font-medium text-gray-700 mb-2">üìù Example</h4>
                    <pre class="text-sm">${lesson.example}</pre>
                </div>
                <button id="hintBtn" class="bg-rugby-gold hover:bg-yellow-500 text-gray-800 px-4 py-2 rounded-md text-sm font-medium transition-colors mb-2">
                    üí° Need a Hint?
                </button>
                <div id="hintContent" class="hint-content hidden">
                    <p class="text-gray-800">${lesson.hint}</p>
                </div>
            `;
            
            updateTestListUI(lesson.tests);
            codeEditorEl.value = `# Solve the challenge for: ${lesson.conceptName}\n# ${lesson.masteryDefinition}\n\n`;
            
            const hintBtn = document.getElementById('hintBtn');
            const hintContent = document.getElementById('hintContent');
            hintBtn.addEventListener('click', () => hintContent.classList.toggle('hidden'));
            appendToConsole(`\n--- Lesson ${lessonId} loaded: ${lesson.conceptName} ---`);
        }

        function updateTestListUI(tests, results = []) {
            testListEl.innerHTML = tests.map((test, index) => {
                let statusClass = 'bg-gray-400';
                let statusText = 'Not Run';
                if (results[index] === true) {
                    statusClass = 'bg-rugby-green';
                    statusText = 'Pass';
                } else if (results[index] === false) {
                    statusClass = 'bg-red-500';
                    statusText = 'Fail';
                }
                return `
                    <div class="flex items-center justify-between">
                        <span>${test.description}</span>
                        <span class="text-xs font-bold text-white px-2 py-1 rounded-full ${statusClass}">${statusText}</span>
                    </div>
                `;
            }).join('');
        }

        function appendToConsole(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutputEl.textContent += `\n[${timestamp}] ${message}`;
            consoleOutputEl.scrollTop = consoleOutputEl.scrollHeight;
        }

        function clearConsole() {
            consoleOutputEl.textContent = 'Python Rugby Academy Console';
        }

        function runCodeAndTests() {
            if (!currentLessonId) return;
            const userCode = codeEditorEl.value;
            const lesson = curriculum[currentLessonId];
            const testResults = [];
            let capturedOutput = "";
            appendToConsole('\n--- Running Code & Tests ---');
            try {
                const context = {};
                const oldLog = console.log;
                console.log = (val) => capturedOutput += val + '\n';
                const userFunction = new Function('context', `with(context) { ${userCode} }`);
                userFunction(context);
                console.log = oldLog;
                lesson.tests.forEach(test => {
                    let result = false;
                    try {
                        const testFunc = new Function('context', '__output', `with(context) { ${test.test} }`);
                        result = testFunc(context, capturedOutput);
                    } catch (e) {
                        result = false;
                        appendToConsole(`Test Error: ${e.message}`);
                    }
                    testResults.push(!!result);
                });
                if (capturedOutput) appendToConsole(`Output:\n${capturedOutput.trim()}`);
                appendToConsole('Execution complete.');
            } catch (e) {
                appendToConsole(`Code Error: ${e.message}`);
                lesson.tests.forEach(() => testResults.push(false));
            }
            updateTestListUI(lesson.tests, testResults);
            if (testResults.every(res => res === true)) {
                 appendToConsole('Great job! You\'ve mastered this concept. üèâ');
            } else {
                 appendToConsole('Not quite. Check the failed tests and try again.');
            }
        }

        // --- Event Listeners ---
        lessonSelectorEl.addEventListener('change', (e) => loadLesson(e.target.value));
        runCodeBtn.addEventListener('click', runCodeAndTests);
        clearConsoleBtn.addEventListener('click', clearConsole);
        codeEditorEl.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                runCodeAndTests();
            }
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                e.target.value = e.target.value.substring(0, start) + '    ' + e.target.value.substring(end);
                e.target.selectionStart = e.target.selectionEnd = start + 4;
            }
        });

        // --- PWA Service Worker ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('SW registered:', reg))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }

        // --- Initialize App ---
        document.addEventListener('DOMContentLoaded', () => {
            populateLessonSelector();
            loadLesson('1.1'); // Load the first lesson by default
        });
    </script>
</body>
</html>
